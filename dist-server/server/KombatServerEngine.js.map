{"version":3,"sources":["../../src/server/KombatServerEngine.js"],"names":["KombatServerEngine","io","gameEngine","inputOptions","on","shoot","bind","walls","forEach","w","wall","Wall","position","TwoVector","addObjectToWorld","socket","playerKombat","Kombat","playerId","max_health","health","socketId","world","queryObject","instanceType","removeObjectFromWorld","id","player","speed","liveTimer","bullet","Bullet","direction","ownerId","x","width","y","height","velocity","Math","cos","sin","timer","add","destroyObjectById","objects","ServerEngine"],"mappings":"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","sourcesContent":["import { ServerEngine, TwoVector } from 'lance-gg';\r\nimport Kombat from '../common/Kombat';\r\nimport Bullet from '../common/Bullet';\r\nimport Wall from '../common/Wall';\r\n\r\nexport default class KombatServerEngine extends ServerEngine {\r\n\r\n    constructor(io, gameEngine, inputOptions) {\r\n        super(io, gameEngine, inputOptions);\r\n        this.gameEngine.on('shoot', this.shoot.bind(this));\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n        let walls = [\r\n\r\n            [0,0],\r\n            [2, 19],\r\n            [12,4],\r\n            [3,9],\r\n            [16, 16],\r\n            [22, 13],\r\n            [8,26],\r\n        ];\r\n        walls.forEach(w => {\r\n            let wall = new Wall(this.gameEngine, null, { position: new TwoVector(w[0], w[1]) });\r\n            this.gameEngine.addObjectToWorld(wall);\r\n        });\r\n    }\r\n\r\n    onPlayerConnected(socket) {\r\n        super.onPlayerConnected(socket);\r\n        let playerKombat = new Kombat(this.gameEngine, null, { position: new TwoVector(10, 10) });\r\n        playerKombat.playerId = socket.playerId;\r\n        playerKombat.max_health = 10;\r\n        playerKombat.health = 10;\r\n        this.gameEngine.addObjectToWorld(playerKombat);\r\n    }\r\n\r\n    onPlayerDisconnected(socketId, playerId) {\r\n        super.onPlayerDisconnected(socketId, playerId);\r\n        let playerKombat = this.gameEngine.world.queryObject({ playerId: playerId,  instanceType: Kombat });\r\n        if (playerKombat) this.gameEngine.removeObjectFromWorld(playerKombat.id);\r\n    }\r\n\r\n    shoot(player) {\r\n        \r\n        let speed = 0.7;\r\n        let liveTimer = 70; //gameloops\r\n        let bullet = new Bullet(this.gameEngine, null, { \r\n            direction: player.direction,\r\n            playerId: player.playerId,\r\n            ownerId: player.id,\r\n           \r\n            position: new TwoVector(\r\n                player.position.x + (player.width / 4),\r\n                player.position.y + (player.height / 4)\r\n            ),\r\n            velocity: new TwoVector(\r\n                Math.cos(player.direction) * speed ,\r\n                Math.sin(player.direction) * speed\r\n            )\r\n        });\r\n        this.gameEngine.addObjectToWorld(bullet);\r\n        this.gameEngine.timer.add(liveTimer, this.destroyObjectById, this, [bullet.id]);\r\n    }\r\n\r\n    destroyObjectById(id) {\r\n        if (this.gameEngine.world.objects[id]) {\r\n            this.gameEngine.removeObjectFromWorld(id);\r\n        }\r\n    }\r\n\r\n}\r\n"],"file":"KombatServerEngine.js"}