{"version":3,"sources":["../../src/server/KombatServerEngine.js"],"names":["KombatServerEngine","io","gameEngine","inputOptions","on","shoot","bind","socket","playerKombat","Kombat","position","TwoVector","direction","playerId","addObjectToWorld","socketId","world","queryObject","instanceType","removeObjectFromWorld","id","player","speed","bullet","Bullet","ownerId","x","width","y","height","velocity","Math","cos","sin","timer","add","destroyBullet","bulletId","objects","ServerEngine"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;IAEqBA,kB;;;;;AAEjB,8BAAYC,EAAZ,EAAgBC,UAAhB,EAA4BC,YAA5B,EAA0C;AAAA;;AAAA;;AACtC,4FAAMF,EAAN,EAAUC,UAAV,EAAsBC,YAAtB;;AACA,UAAKD,UAAL,CAAgBE,EAAhB,CAAmB,OAAnB,EAA4B,MAAKC,KAAL,CAAWC,IAAX,+BAA5B;;AAFsC;AAGzC;;;;4BAEO;AACJ,oFADI,CAEJ;AACA;;AACH;;;sCAEiBC,M,EAAQ;AACtB,gGAAwBA,MAAxB;;AACA,UAAIC,YAAY,GAAG,IAAIC,eAAJ,CAAW,KAAKP,UAAhB,EAA4B,IAA5B,EAAkC;AAAEQ,QAAAA,QAAQ,EAAE,IAAIC,kBAAJ,CAAc,EAAd,EAAkB,EAAlB;AAAZ,OAAlC,CAAnB;AACAH,MAAAA,YAAY,CAACI,SAAb,GAAyB,CAAzB;AACAJ,MAAAA,YAAY,CAACK,QAAb,GAAwBN,MAAM,CAACM,QAA/B;AACA,WAAKX,UAAL,CAAgBY,gBAAhB,CAAiCN,YAAjC;AACH;;;yCAEoBO,Q,EAAUF,Q,EAAU;AACrC,mGAA2BE,QAA3B,EAAqCF,QAArC;;AACA,UAAIL,YAAY,GAAG,KAAKN,UAAL,CAAgBc,KAAhB,CAAsBC,WAAtB,CAAkC;AAAEJ,QAAAA,QAAQ,EAAEA,QAAZ;AAAuBK,QAAAA,YAAY,EAAET;AAArC,OAAlC,CAAnB;AACA,UAAID,YAAJ,EAAkB,KAAKN,UAAL,CAAgBiB,qBAAhB,CAAsCX,YAAY,CAACY,EAAnD;AACrB;;;0BAEKC,M,EAAQ;AAEV,UAAIC,KAAK,GAAG,IAAZ;AAEA,UAAIC,MAAM,GAAG,IAAIC,eAAJ,CAAW,KAAKtB,UAAhB,EAA4B,IAA5B,EAAkC;AAC3CU,QAAAA,SAAS,EAAES,MAAM,CAACT,SADyB;AAE3CC,QAAAA,QAAQ,EAAEQ,MAAM,CAACR,QAF0B;AAG3CY,QAAAA,OAAO,EAAEJ,MAAM,CAACD,EAH2B;AAI3CV,QAAAA,QAAQ,EAAE,IAAIC,kBAAJ,CACNU,MAAM,CAACX,QAAP,CAAgBgB,CAAhB,GAAqBL,MAAM,CAACM,KAAP,GAAe,CAD9B,EAENN,MAAM,CAACX,QAAP,CAAgBkB,CAAhB,GAAqBP,MAAM,CAACQ,MAAP,GAAgB,CAF/B,CAJiC;AAQ3CC,QAAAA,QAAQ,EAAE,IAAInB,kBAAJ,CACNoB,IAAI,CAACC,GAAL,CAASX,MAAM,CAACT,SAAhB,IAA6BU,KADvB,EAENS,IAAI,CAACE,GAAL,CAASZ,MAAM,CAACT,SAAhB,IAA6BU,KAFvB;AARiC,OAAlC,CAAb;AAaA,WAAKpB,UAAL,CAAgBY,gBAAhB,CAAiCS,MAAjC;AACA,WAAKrB,UAAL,CAAgBgC,KAAhB,CAAsBC,GAAtB,CAA0B,EAA1B,EAA8B,KAAKC,aAAnC,EAAkD,IAAlD,EAAwD,CAACb,MAAM,CAACH,EAAR,CAAxD;AACH;;;kCAEaiB,Q,EAAU;AACpB,UAAI,KAAKnC,UAAL,CAAgBc,KAAhB,CAAsBsB,OAAtB,CAA8BD,QAA9B,CAAJ,EAA6C;AACzC,aAAKnC,UAAL,CAAgBiB,qBAAhB,CAAsCkB,QAAtC;AACH;AACJ;;;;EApD2CE,qB","sourcesContent":["import { ServerEngine, TwoVector } from 'lance-gg';\r\nimport Kombat from '../common/Kombat';\r\nimport Bullet from '../common/Bullet';\r\nimport Box from '../common/Box';\r\n\r\nexport default class KombatServerEngine extends ServerEngine {\r\n\r\n    constructor(io, gameEngine, inputOptions) {\r\n        super(io, gameEngine, inputOptions);\r\n        this.gameEngine.on('shoot', this.shoot.bind(this));\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n        // let testBox = new Box(this.gameEngine, null, { position: new TwoVector(0, 0) });\r\n        // this.gameEngine.addObjectToWorld(testBox);\r\n    }\r\n\r\n    onPlayerConnected(socket) {\r\n        super.onPlayerConnected(socket);\r\n        let playerKombat = new Kombat(this.gameEngine, null, { position: new TwoVector(10, 10) });\r\n        playerKombat.direction = 0;\r\n        playerKombat.playerId = socket.playerId;\r\n        this.gameEngine.addObjectToWorld(playerKombat);\r\n    }\r\n\r\n    onPlayerDisconnected(socketId, playerId) {\r\n        super.onPlayerDisconnected(socketId, playerId);\r\n        let playerKombat = this.gameEngine.world.queryObject({ playerId: playerId,  instanceType: Kombat });\r\n        if (playerKombat) this.gameEngine.removeObjectFromWorld(playerKombat.id);\r\n    }\r\n\r\n    shoot(player) {\r\n        \r\n        let speed = 0.01;\r\n  \r\n        let bullet = new Bullet(this.gameEngine, null, { \r\n            direction: player.direction,\r\n            playerId: player.playerId,\r\n            ownerId: player.id,\r\n            position: new TwoVector(\r\n                player.position.x + (player.width / 4),\r\n                player.position.y + (player.height / 4)\r\n            ),\r\n            velocity: new TwoVector(\r\n                Math.cos(player.direction) * speed ,\r\n                Math.sin(player.direction) * speed\r\n            )\r\n        });\r\n        this.gameEngine.addObjectToWorld(bullet);\r\n        this.gameEngine.timer.add(60, this.destroyBullet, this, [bullet.id]);\r\n    }\r\n\r\n    destroyBullet(bulletId) {\r\n        if (this.gameEngine.world.objects[bulletId]) {\r\n            this.gameEngine.removeObjectFromWorld(bulletId);\r\n        }\r\n    }\r\n\r\n}\r\n"],"file":"KombatServerEngine.js"}