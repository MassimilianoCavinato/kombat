{"version":3,"sources":["../../src/client/KombatClientEngine.js"],"names":["KombatClientEngine","gameEngine","options","KombatRenderer","angle","up","down","left","mouseIsDown","controls","KeyboardControls","GAME_CANVAS","document","getElementById","addEventListener","e","updateAngle","handleMouse","preventDefault","handleKeyDown","handleKeyUp","on","preStep","obj","playerId","type","querySelector","style","display","kombat_name","value","setTimeout","sendInput","toString","trim","Math","atan2","pageY","window","innerHeight","pageX","innerWidth","player","world","queryObject","right","repeat","isTrusted","key","which","ClientEngine"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;IAEqBA,kB;;;;;AAEjB,8BAAYC,UAAZ,EAAwBC,OAAxB,EAAiC;AAAA;;AAAA;;AAE7B,4FAAMD,UAAN,EAAkBC,OAAlB,EAA2BC,uBAA3B;AAEA,UAAKC,KAAL,GAAa,CAAb;AACA,UAAKC,EAAL,GAAU,KAAV;AACA,UAAKC,IAAL,GAAY,KAAZ;AACA,UAAKC,IAAL,GAAY,KAAZ;AACA,UAAKD,IAAL,GAAY,KAAZ;AACA,UAAKE,WAAL,GAAmB,KAAnB;AACA,UAAKC,QAAL,GAAgB,IAAIC,yBAAJ,+BAAhB,CAV6B,CAW7B;;AACA,QAAIC,WAAW,GAAGC,QAAQ,CAACC,cAAT,CAAwB,IAAxB,CAAlB;AAEAF,IAAAA,WAAW,CAACG,gBAAZ,CAA6B,YAA7B,EAA2C,UAACC,CAAD;AAAA,aAAO,MAAKC,WAAL,CAAiBD,CAAjB,CAAP;AAAA,KAA3C;AACAJ,IAAAA,WAAW,CAACG,gBAAZ,CAA6B,WAA7B,EAA0C,UAACC,CAAD;AAAA,aAAO,MAAKC,WAAL,CAAiBD,CAAjB,CAAP;AAAA,KAA1C;AACAJ,IAAAA,WAAW,CAACG,gBAAZ,CAA6B,WAA7B,EAA0C,UAACC,CAAD;AAAA,aAAO,MAAKE,WAAL,CAAiBF,CAAjB,CAAP;AAAA,KAA1C;AACAJ,IAAAA,WAAW,CAACG,gBAAZ,CAA6B,SAA7B,EAAwC,UAACC,CAAD;AAAA,aAAO,MAAKE,WAAL,CAAiBF,CAAjB,CAAP;AAAA,KAAxC;AACAJ,IAAAA,WAAW,CAACG,gBAAZ,CAA6B,aAA7B,EAA4C,UAACC,CAAD;AAAA,aAAOA,CAAC,CAACG,cAAF,EAAP;AAAA,KAA5C;AACAN,IAAAA,QAAQ,CAACE,gBAAT,CAA0B,SAA1B,EAAqC,UAACC,CAAD;AAAA,aAAO,MAAKI,aAAL,CAAmBJ,CAAnB,CAAP;AAAA,KAArC;AACAH,IAAAA,QAAQ,CAACE,gBAAT,CAA0B,OAA1B,EAAmC,UAACC,CAAD;AAAA,aAAO,MAAKK,WAAL,CAAiBL,CAAjB,CAAP;AAAA,KAAnC;;AAEA,UAAKd,UAAL,CAAgBoB,EAAhB,CAAmB,iBAAnB,EAAsC;AAAA,aAAM,MAAKC,OAAL,EAAN;AAAA,KAAtC;;AACA,UAAKrB,UAAL,CAAgBoB,EAAhB,CAAmB,iBAAnB,EAAsC,UAACE,GAAD,EAAS;AAC3C,UAAIA,GAAG,CAACC,QAAJ,KAAiBvB,UAAU,CAACuB,QAA5B,IAAwCD,GAAG,CAACE,IAAJ,KAAa,QAAzD,EAAmE;AAC/Db,QAAAA,QAAQ,CAACc,aAAT,CAAuB,cAAvB,EAAuCC,KAAvC,CAA6CC,OAA7C,GAAuD,OAAvD;AACH;AACJ,KAJD;;AAKA,UAAK3B,UAAL,CAAgBoB,EAAhB,CAAmB,OAAnB,EAA4B,UAACN,CAAD,EAAO;AAE/B,UAAIc,WAAW,GAAGjB,QAAQ,CAACc,aAAT,CAAuB,cAAvB,EAAuCI,KAAzD;AACAC,MAAAA,UAAU,CAAC;AAAA,eAAM,MAAKC,SAAL,CAAe,aAAf,EAA8B;AAAEH,UAAAA,WAAW,EAAEA,WAAW,CAACI,QAAZ,GAAuBC,IAAvB;AAAf,SAA9B,CAAN;AAAA,OAAD,EAAqF,IAArF,CAAV;AACH,KAJD;;AA5B6B;AAiChC;;;;gCAEWnB,C,EAAG;AAEXA,MAAAA,CAAC,CAACG,cAAF;AACA,WAAKd,KAAL,GAAa+B,IAAI,CAACC,KAAL,CAAWrB,CAAC,CAACsB,KAAF,GAAUC,MAAM,CAACC,WAAP,GAAmB,CAAxC,EAA2CxB,CAAC,CAACyB,KAAF,GAAUF,MAAM,CAACG,UAAP,GAAkB,CAAvE,CAAb;AACH;;;8BAES;AAEN,UAAIC,MAAM,GAAG,KAAKzC,UAAL,CAAgB0C,KAAhB,CAAsBC,WAAtB,CAAkC;AAAEpB,QAAAA,QAAQ,EAAE,KAAKvB,UAAL,CAAgBuB;AAA5B,OAAlC,CAAb;;AAEA,UAAGkB,MAAM,KAAK,IAAd,EAAmB;AAEf,aAAKV,SAAL,CAAe,MAAf,EAAuB;AACnB3B,UAAAA,EAAE,EAAE,KAAKA,EADU;AAEnBE,UAAAA,IAAI,EAAE,KAAKA,IAFQ;AAGnBD,UAAAA,IAAI,EAAE,KAAKA,IAHQ;AAInBuC,UAAAA,KAAK,EAAE,KAAKA,KAJO;AAKnBzC,UAAAA,KAAK,EAAE,KAAKA;AALO,SAAvB;;AAQA,YAAG,KAAKI,WAAL,KAAqB,IAAxB,EAA6B;AACzB,eAAKwB,SAAL,CAAe,OAAf,EAAwB;AAAEc,YAAAA,MAAM,EAAE;AAAV,WAAxB;AACH;AACJ;AACJ;;;kCAEa/B,C,EAAE;AACZ,UAAGA,CAAC,CAACgC,SAAF,KAAgB,IAAnB,EAAwB;AACpB,YAAGhC,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,SAA9B,EAAwC;AACpC,eAAK3C,EAAL,GAAU,IAAV;AACH,SAFD,MAGK,IAAGU,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,WAA9B,EAA0C;AAC3C,eAAKzC,IAAL,GAAY,IAAZ;AACH,SAFI,MAGA,IAAGQ,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,WAA9B,EAA0C;AAC3C,eAAK1C,IAAL,GAAY,IAAZ;AACH,SAFI,MAGA,IAAGS,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,YAA9B,EAA2C;AAC5C,eAAKH,KAAL,GAAa,IAAb;AACH;AACJ;AACJ;;;gCAEW9B,C,EAAE;AACV,UAAGA,CAAC,CAACgC,SAAF,KAAgB,IAAnB,EAAwB;AACpB,YAAGhC,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,SAA9B,EAAwC;AACpC,eAAK3C,EAAL,GAAU,KAAV;AACH,SAFD,MAGK,IAAGU,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,WAA9B,EAA0C;AAC3C,eAAKzC,IAAL,GAAY,KAAZ;AACH,SAFI,MAGA,IAAGQ,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,WAA9B,EAA0C;AAC3C,eAAK1C,IAAL,GAAY,KAAZ;AACH,SAFI,MAGA,IAAGS,CAAC,CAACiC,GAAF,KAAU,GAAV,IAAiBjC,CAAC,CAACiC,GAAF,KAAU,YAA9B,EAA2C;AAC5C,eAAKH,KAAL,GAAa,KAAb;AACH;AACJ;AACJ;;;gCAEW9B,C,EAAE;AACVA,MAAAA,CAAC,CAACG,cAAF;;AACA,UAAGH,CAAC,CAACgC,SAAF,KAAgB,IAAnB,EAAwB;AACpB,YAAGhC,CAAC,CAACkC,KAAF,KAAY,CAAf,EAAiB;AACb,eAAKzC,WAAL,GAAmBO,CAAC,CAACU,IAAF,KAAW,WAA9B;AACH,SAFD,MAGK,IAAGV,CAAC,CAACkC,KAAF,KAAY,CAAf,EAAiB;AAClB,cAAGlC,CAAC,CAACU,IAAF,KAAW,WAAd,EAA0B;AACtB,iBAAKO,SAAL,CAAe,aAAf,EAA8B;AAAEc,cAAAA,MAAM,EAAE;AAAV,aAA9B;AACH;;AACD,cAAG/B,CAAC,CAACU,IAAF,KAAW,SAAd,EAAwB;AACpB,iBAAKO,SAAL,CAAe,SAAf,EAA0B;AAAEc,cAAAA,MAAM,EAAE;AAAV,aAA1B;AACH;AACJ;AACJ;AACJ;;;;EAhH2CI,qB","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\nimport KombatRenderer from '../client/KombatRenderer';\n\nexport default class KombatClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n\n        super(gameEngine, options, KombatRenderer);\n\n        this.angle = 0;\n        this.up = false;\n        this.down = false;\n        this.left = false;\n        this.down = false;\n        this.mouseIsDown = false;\n        this.controls = new KeyboardControls(this);\n        //LISTENERS\n        let GAME_CANVAS = document.getElementById('kc');\n\n        GAME_CANVAS.addEventListener('mouseenter', (e) => this.updateAngle(e));\n        GAME_CANVAS.addEventListener('mousemove', (e) => this.updateAngle(e));\n        GAME_CANVAS.addEventListener('mousedown', (e) => this.handleMouse(e));\n        GAME_CANVAS.addEventListener('mouseup', (e) => this.handleMouse(e));\n        GAME_CANVAS.addEventListener('contextmenu', (e) => e.preventDefault());\n        document.addEventListener('keydown', (e) => this.handleKeyDown(e));\n        document.addEventListener('keyup', (e) => this.handleKeyUp(e));\n\n        this.gameEngine.on('client__preStep', () => this.preStep());\n        this.gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId && obj.type === \"Kombat\") {\n                document.querySelector('#kombat-menu').style.display = \"block\";\n            }\n        });\n        this.gameEngine.on('start', (e) => {\n            \n            let kombat_name = document.querySelector('#kombat-name').value;\n            setTimeout(() => this.sendInput('kombat_name', { kombat_name: kombat_name.toString().trim()}), 1000);\n        });\n    }\n\n    updateAngle(e) {\n        \n        e.preventDefault();\n        this.angle = Math.atan2(e.pageY - window.innerHeight/2, e.pageX - window.innerWidth/2);\n    }\n    \n    preStep() {\n        \n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        \n        if(player !== null){\n            \n            this.sendInput('step', { \n                up: this.up,\n                left: this.left,\n                down: this.down,\n                right: this.right,\n                angle: this.angle\n            });\n\n            if(this.mouseIsDown === true){\n                this.sendInput(\"shoot\", { repeat: true });\n            }\n        }\n    }\n\n    handleKeyDown(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = true;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = true;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = true;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = true;\n            }\n        }\n    }\n\n    handleKeyUp(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = false;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = false;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = false;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = false;\n            }\n        }\n    }\n\n    handleMouse(e){\n        e.preventDefault();\n        if(e.isTrusted === true){\n            if(e.which === 1){\n                this.mouseIsDown = e.type === \"mousedown\";\n            }\n            else if(e.which === 3){\n                if(e.type === 'mousedown'){\n                    this.sendInput('throw_power', { repeat: false });\n                }\n                if(e.type === 'mouseup'){\n                    this.sendInput('granade', { repeat: false });\n                }\n            }\n        }\n    }\n\n}\n"],"file":"KombatClientEngine.js"}