{"version":3,"sources":["../../src/client/KombatRenderer.js"],"names":["ctx","canvas","game","C_WIDTH","C_HEIGHT","KombatRenderer","gameEngine","clientEngine","document","createElement","width","height","body","appendChild","w","h","zoom","getContext","lineWidth","offsetX","offsetY","t","dt","resetRender","playerKombat","world","queryObject","playerId","instanceType","Kombat","position","x","y","queryObjects","Blood","forEach","obj","drawBlood","forEachObject","id","drawKombat","Bullet","drawBullet","Wall","drawWall","drawUI","restore","clearRect","save","fillStyle","fillRect","translate","scale","health","max_health","TwoVector","edge","Math","SQRT2","strokeStyle","center","getCenter","radius","getCircumscribedRadiusLength","drawCircle","beginPath","moveTo","lineTo","cos","direction","sin","stroke","drawBox","splatter","sp","arc","PI","fill","closePath","r","rect","Renderer"],"mappings":"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","sourcesContent":["import { Renderer, TwoVector } from 'lance-gg';\r\nimport Kombat from '../common/Kombat';\r\nimport Bullet from '../common/Bullet';\r\nimport Wall from '../common/Wall';\r\nimport Blood from '../common/Blood';\r\n\r\nlet ctx = null;\r\nlet canvas = null;\r\nlet game = null;\r\nconst C_WIDTH = 800;\r\nconst C_HEIGHT = 600;\r\n\r\nexport default class KombatRenderer extends Renderer {\r\n\r\n    constructor(gameEngine, clientEngine) {\r\n        super(gameEngine, clientEngine);\r\n        game = gameEngine;\r\n        canvas = document.createElement('canvas');\r\n        canvas.width = C_WIDTH;\r\n        canvas.height = C_HEIGHT;\r\n        document.body.appendChild(canvas);\r\n        game.w = canvas.width;\r\n        game.h = canvas.height;\r\n        clientEngine.zoom = 10;\r\n        ctx = canvas.getContext('2d');\r\n        ctx.lineWidth = 2 / clientEngine.zoom;\r\n        this.offsetX = 0;\r\n        this.offsetY = 0;\r\n    }\r\n\r\n    draw(t, dt) {\r\n        super.draw(t, dt);\r\n        this.resetRender();\r\n        let playerKombat = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId,  instanceType: Kombat });\r\n        if(playerKombat){\r\n            this.offsetX = (C_WIDTH/2)/this.clientEngine.zoom - playerKombat.position.x - (playerKombat.width / 2);\r\n            this.offsetY = (C_HEIGHT/2)/this.clientEngine.zoom - playerKombat.position.y - (playerKombat.height / 2);\r\n            //draw blood stains first // layer 0\r\n            game.world.queryObjects({instanceType: Blood}).forEach(obj => {\r\n                this.drawBlood(obj);\r\n            });\r\n            game.world.forEachObject((id, obj) => {\r\n                if (obj instanceof Kombat) this.drawKombat(obj);\r\n                else if (obj instanceof Bullet) this.drawBullet(obj);\r\n                else if (obj instanceof Wall) this.drawWall(obj);\r\n            });\r\n            this.drawUI(playerKombat);\r\n        }\r\n        ctx.restore();\r\n    }\r\n\r\n    resetRender(){\r\n        ctx.clearRect(0, 0, game.w, game.h);\r\n        ctx.save();\r\n        ctx.fillStyle = \"black\";\r\n        ctx.fillRect(0, 0, 800, 600 );\r\n        ctx.translate(0, 0);\r\n        ctx.scale(this.clientEngine.zoom, this.clientEngine.zoom);  // Zoom in and flip y axis\r\n    }\r\n\r\n    drawUI(obj){\r\n        ctx.fillStyle = \"red\";\r\n        ctx.fillRect(10/ this.clientEngine.zoom, 580/ this.clientEngine.zoom, obj.health * ( 780 / obj.max_health)/ this.clientEngine.zoom, 10/ this.clientEngine.zoom);\r\n    }\r\n\r\n    getCenter(obj){\r\n        return new TwoVector(\r\n            obj.position.x + this.offsetX + obj.width/2,\r\n            obj.position.y + this.offsetY + obj.height/2\r\n        )\r\n    }\r\n\r\n    getCircumscribedRadiusLength(edge){\r\n        return (edge * Math.SQRT2) / 2;\r\n    }\r\n\r\n    drawKombat(obj) {\r\n        ctx.fillStyle = \"transparent\";\r\n        ctx.strokeStyle = obj.playerId === this.gameEngine.playerId ? \"dodgerblue\" : \"crimson\";\r\n        let center = this.getCenter(obj);\r\n        let radius = this.getCircumscribedRadiusLength(obj.width);\r\n        this.drawCircle(center.x, center.y, radius);\r\n        ctx.beginPath(); \r\n        ctx.moveTo(center.x,center.y);\r\n        ctx.lineTo(center.x + radius * Math.cos(obj.direction), center.y + radius * Math.sin(obj.direction));\r\n        ctx.stroke();\r\n    }\r\n\r\n    drawBullet(obj){\r\n        ctx.fillStyle = \"transparent\";\r\n        ctx.strokeStyle = \"yellow\";\r\n        let center = this.getCenter(obj);\r\n        let radius = this.getCircumscribedRadiusLength(obj.width);\r\n        this.drawCircle(center.x, center.y, radius);\r\n        this.drawBox(center.x, center.y, obj.width, obj.height);\r\n    }\r\n\r\n    drawWall(obj){\r\n        ctx.strokeStyle =  \"white\";\r\n        let center = this.getCenter(obj);\r\n        this.drawBox(center.x, center.y, obj.width, obj.height);\r\n    }\r\n\r\n    drawBlood(obj){\r\n        ctx.fillStyle = 'rgba(255,0,0,.6)';\r\n        let center = this.getCenter(obj);\r\n        obj.splatter.forEach(sp => {\r\n            ctx.beginPath();\r\n            ctx.arc(center.x+sp[0], center.y+sp[1], sp[2], 0, 2*Math.PI);\r\n            ctx.fill();\r\n            ctx.closePath();\r\n        });\r\n    }\r\n\r\n    drawCircle(x, y, r, ) {\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, r, 0, 2*Math.PI);\r\n        ctx.fill();\r\n      \r\n        ctx.stroke();\r\n\r\n        ctx.closePath();\r\n    }\r\n\r\n    drawBox(x, y, w, h){\r\n        ctx.beginPath();\r\n        ctx.rect(x - (w/2), y - (h/2), w, h);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n    }\r\n}\r\n"],"file":"KombatRenderer.js"}