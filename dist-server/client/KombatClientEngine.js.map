{"version":3,"sources":["../../src/client/KombatClientEngine.js"],"names":["KombatClientEngine","gameEngine","options","KombatRenderer","angle","up","down","left","mouseIsDown","controls","KeyboardControls","is_started","document","addEventListener","e","handleKeyDown","handleKeyUp","GAME_CANVAS","getElementById","width","height","updateAngle","handleMouse","preventDefault","NI","PB","focus","sendInput","repeat","playerId","name","querySelector","value","style","display","on","preStep","obj","type","Math","atan2","pageY","window","innerHeight","pageX","innerWidth","player","world","queryObject","right","isTrusted","key","which","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\nimport KombatRenderer from '../client/KombatRenderer';\nimport Kombat from '../common/Kombat';\n\nexport default class KombatClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n\n        super(gameEngine, options, KombatRenderer);\n\n        this.angle = 0;\n        this.up = false;\n        this.down = false;\n        this.left = false;\n        this.down = false;\n        this.mouseIsDown = false;\n        this.controls = new KeyboardControls(this);\n        this.is_started = false;\n        //LISTENERS\n        document.addEventListener('keydown', (e) => this.handleKeyDown(e));\n        document.addEventListener('keyup', (e) => this.handleKeyUp(e));\n\n        let GAME_CANVAS = document.getElementById('kc');\n        GAME_CANVAS.width = 800;\n        GAME_CANVAS.height = 600;\n        GAME_CANVAS.addEventListener('mouseenter', (e) => this.updateAngle(e));\n        GAME_CANVAS.addEventListener('mousemove', (e) => this.updateAngle(e));\n        GAME_CANVAS.addEventListener('mousedown', (e) => this.handleMouse(e));\n        GAME_CANVAS.addEventListener('mouseup', (e) => this.handleMouse(e));\n        GAME_CANVAS.addEventListener('contextmenu', (e) => e.preventDefault());\n        let NI = document.getElementById('kombat-name')\n        let PB = document.getElementById('kombat-play-button');\n        NI.addEventListener('click', e =>{\n            NI.focus()\n        });\n        PB.addEventListener('click', e => {\n            this.sendInput('play', { \n                repeat: false,\n                playerId: this.gameEngine.playerId,\n                name: document.querySelector('#kombat-name').value \n            });\n            document.querySelector('#kombat-menu').style.display = \"none\";\n\n        });\n        this.gameEngine.on('client__preStep', () => this.preStep());\n        this.gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId && obj.type === \"Kombat\") {\n                document.querySelector('#kombat-menu').style.display = \"block\";\n            }\n        });\n    }\n\n    updateAngle(e) {\n        e.preventDefault();\n        this.angle = Math.atan2(e.pageY - window.innerHeight/2, e.pageX - window.innerWidth/2);\n    }\n    \n    preStep() {\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        \n        if(player !== null){\n            \n            this.sendInput('step', { \n                up: this.up,\n                left: this.left,\n                down: this.down,\n                right: this.right,\n                angle: this.angle\n            });\n\n            if(this.mouseIsDown === true){\n                this.sendInput(\"shoot\", { repeat: true });\n            }\n        }\n    }\n\n    handleKeyDown(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = true;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = true;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = true;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = true;\n            }\n            else if(e.key === \"r\"){\n               this.sendInput('reload', { repeat: false });\n            }\n            else if(e.key === \"f\"){\n               this.sendInput('pickup', { repeat: false });\n            }\n        }\n    }\n\n    handleKeyUp(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = false;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = false;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = false;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = false;\n            }\n            \n        }\n    }\n\n    handleMouse(e){\n        e.preventDefault();\n        if(e.isTrusted === true){\n            if(e.which === 1){\n                this.mouseIsDown = e.type === \"mousedown\";\n            }\n            else if(e.which === 3){\n                if(e.type === 'mousedown'){\n                    this.sendInput('throw_power', { repeat: false });\n                }\n                if(e.type === 'mouseup'){\n                    this.sendInput('granade', { repeat: false });\n                }\n            }\n        }\n    }\n\n}\n"],"file":"KombatClientEngine.js"}