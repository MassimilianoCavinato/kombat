{"version":3,"sources":["../../src/client/KombatClientEngine.js"],"names":["KombatClientEngine","gameEngine","options","KombatRenderer","angle","up","down","left","mouseIsDown","controls","KeyboardControls","on","preStep","obj","playerId","type","document","querySelector","style","display","e","addEventListener","updateAngle","bind","handleMouse","preventDefault","handleKeyDown","handleKeyUp","kombat_name","value","setTimeout","sendInput","toString","trim","Math","atan2","pageY","window","innerHeight","pageX","innerWidth","player","world","queryObject","right","repeat","isTrusted","key","which","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\nimport KombatRenderer from '../client/KombatRenderer';\n\nexport default class KombatClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n\n        super(gameEngine, options, KombatRenderer);\n\n        this.angle = 0;\n        this.up = false;\n        this.down = false;\n        this.left = false;\n        this.down = false;\n        this.mouseIsDown = false;\n        this.controls = new KeyboardControls(this);\n        //LISTENERS\n        \n        this.gameEngine.on('client__preStep', () => this.preStep());\n        this.gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId && obj.type === \"Kombat\") {\n                document.querySelector('#kombat-menu').style.display = \"block\";\n            }\n        });\n        this.gameEngine.on('start', (e) => {\n            document.addEventListener('mouseenter', this.updateAngle.bind(this), false);\n            document.addEventListener('mousemove', this.updateAngle.bind(this), false);\n            document.addEventListener('mousedown', (e) => this.handleMouse(e) );\n            document.addEventListener('mouseup', (e) => this.handleMouse(e));\n            document.addEventListener('contextmenu', (e) => e.preventDefault());\n            document.addEventListener('keydown', (e) => this.handleKeyDown(e));\n            document.addEventListener('keyup', (e) => this.handleKeyUp(e));\n            let kombat_name = document.querySelector('#kombat-name').value;\n            setTimeout(() => this.sendInput('kombat_name', { kombat_name: kombat_name.toString().trim()}), 1000);\n        });\n    }\n\n    updateAngle(e) {\n        e.preventDefault();\n        this.angle = Math.atan2(e.pageY - window.innerHeight/2, e.pageX - window.innerWidth/2);\n    }\n    \n    preStep() {\n        \n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        \n        if(player !== null){\n            \n            this.sendInput('step', { \n                up: this.up,\n                left: this.left,\n                down: this.down,\n                right: this.right,\n                angle: this.angle\n            });\n\n            if(this.mouseIsDown === true){\n                this.sendInput(\"shoot\", { repeat: true });\n            }\n        }\n    }\n\n    handleKeyDown(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = true;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = true;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = true;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = true;\n            }\n        }\n    }\n\n    handleKeyUp(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = false;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = false;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = false;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = false;\n            }\n        }\n    }\n\n    handleMouse(e){\n        e.preventDefault();\n        if(e.isTrusted === true){\n            if(e.which === 1){\n                this.mouseIsDown = e.type === \"mousedown\";\n            }\n            else if(e.which === 3){\n                if(e.type === 'mousedown'){\n                    this.sendInput('throw_power', { repeat: false });\n                }\n                if(e.type === 'mouseup'){\n                    this.sendInput('granade', { repeat: false });\n                }\n            }\n        }\n    }\n\n}\n"],"file":"KombatClientEngine.js"}