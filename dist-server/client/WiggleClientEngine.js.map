{"version":3,"sources":["../../src/client/WiggleClientEngine.js"],"names":["WiggleClientEngine","gameEngine","options","WiggleRenderer","controls","KeyboardControls","bindKey","repeat","document","querySelector","addEventListener","window","location","reload","on","obj","playerId","body","classList","add","disabled","mouseX","mouseY","updateMouseXY","bind","e","shoot","sendMouseAngle","preventDefault","pageX","pageY","player","world","queryObject","clientWidth","zoom","clientHeight","dx","position","y","dy","x","angle","Math","atan2","sendInput","movement","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\r\nimport WiggleRenderer from '../client/WiggleRenderer';\r\n\r\nexport default class WiggleClientEngine extends ClientEngine {\r\n\r\n    constructor(gameEngine, options) {\r\n        super(gameEngine, options, WiggleRenderer);\r\n        this.controls = new KeyboardControls(this);\r\n        this.controls.bindKey('w', 'up', { repeat: true } );\r\n        this.controls.bindKey('s', 'down', { repeat: true } );\r\n        this.controls.bindKey('a', 'left', { repeat: true } );\r\n        this.controls.bindKey('d', 'right', { repeat: true } );\r\n        // restart game\r\n        document.querySelector('#tryAgain').addEventListener('click', () => {\r\n            window.location.reload();\r\n        });\r\n        // show try-again button\r\n        gameEngine.on('objectDestroyed', (obj) => {\r\n            if (obj.playerId === gameEngine.playerId) {\r\n                document.body.classList.add('lostGame');\r\n                document.querySelector('#tryAgain').disabled = false;\r\n            }\r\n        });\r\n\r\n        this.mouseX = null;\r\n        this.mouseY = null;\r\n        document.addEventListener('mousemove', this.updateMouseXY.bind(this), false);\r\n        document.addEventListener('mouseenter', this.updateMouseXY.bind(this), false);\r\n        document.addEventListener('mousedown', (e) => this.shoot(e));\r\n        this.gameEngine.on('client__preStep', this.sendMouseAngle.bind(this));\r\n    }\r\n\r\n    updateMouseXY(e) {\r\n        e.preventDefault();\r\n        this.mouseX = e.pageX;\r\n        this.mouseY = e.pageY;\r\n    }\r\n\r\n    sendMouseAngle() {\r\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\r\n        if (this.mouseY === null || player === null) return;\r\n        let mouseX = (this.mouseX - document.body.clientWidth/2) / this.zoom;\r\n        let mouseY = (this.mouseY - document.body.clientHeight/2) / this.zoom;\r\n        let dx = mouseY - player.position.y;\r\n        let dy = mouseX - player.position.x;\r\n        let angle = Math.atan2(dx, dy);\r\n        this.sendInput(angle, { movement: true });\r\n    }\r\n\r\n    shoot(){\r\n        this.sendInput(\"shoot\", { movement: true });\r\n    }\r\n}\r\n"],"file":"WiggleClientEngine.js"}