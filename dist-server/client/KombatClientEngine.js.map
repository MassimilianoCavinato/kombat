{"version":3,"sources":["../../src/client/KombatClientEngine.js"],"names":["KombatClientEngine","gameEngine","options","KombatRenderer","angle","up","down","left","mouseIsDown","controls","KeyboardControls","document","querySelector","addEventListener","window","location","reload","updateAngle","bind","e","handleMouse","preventDefault","handleKeyDown","handleKeyUp","on","preStep","obj","playerId","type","style","display","setTimeout","getElementById","Math","atan2","pageY","innerHeight","pageX","innerWidth","player","world","queryObject","sendInput","right","repeat","isTrusted","key","which","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\nimport KombatRenderer from '../client/KombatRenderer';\n\nexport default class KombatClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n\n        super(gameEngine, options, KombatRenderer);\n\n        this.angle = 0;\n        this.up = false;\n        this.down = false;\n        this.left = false;\n        this.down = false;\n        this.mouseIsDown = false;\n        this.controls = new KeyboardControls(this);\n        //LISTENERS\n        document.querySelector('#try-again').addEventListener('click', () => window.location.reload());\n        document.addEventListener('mouseenter', this.updateAngle.bind(this), false);\n        document.addEventListener('mousemove', this.updateAngle.bind(this), false);\n        document.addEventListener('mousedown', (e) => this.handleMouse(e) );\n        document.addEventListener('mouseup', (e) => this.handleMouse(e));\n        document.addEventListener('contextmenu', (e) => e.preventDefault());\n        document.addEventListener('keydown', (e) => this.handleKeyDown(e));\n        document.addEventListener('keyup', (e) => this.handleKeyUp(e));\n        this.gameEngine.on('client__preStep', () => this.preStep());\n        this.gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId && obj.type === \"Kombat\") {\n                document.querySelector('#try-again').style.display = \"block\";\n            }\n        });\n        setTimeout( () => document.getElementById('kombat-instructions').style.display = 'none', 5000);\n    }\n\n    updateAngle(e) {\n        e.preventDefault();\n        this.angle = Math.atan2(e.pageY - window.innerHeight/2, e.pageX - window.innerWidth/2);\n    }\n    \n    preStep() {\n        \n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        \n        if(player !== null){\n            \n            this.sendInput('step', { \n                up: this.up,\n                left: this.left,\n                down: this.down,\n                right: this.right,\n                angle: this.angle\n            });\n\n            if(this.mouseIsDown === true){\n                this.sendInput(\"shoot\", { repeat: true });\n            }\n        }\n    }\n\n    handleKeyDown(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = true;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = true;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = true;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = true;\n            }\n        }\n    }\n\n    handleKeyUp(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = false;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = false;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = false;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = false;\n            }\n        }\n    }\n\n    handleMouse(e){\n        e.preventDefault();\n        if(e.isTrusted === true){\n            if(e.which === 1){\n                this.mouseIsDown = e.type === \"mousedown\";\n            }\n            else if(e.which === 3){\n                if(e.type === 'mousedown'){\n                    this.sendInput('throw_power', { repeat: false });\n                }\n                if(e.type === 'mouseup'){\n                    this.sendInput('granade', { repeat: false });\n                }\n            }\n        }\n    }\n\n}\n"],"file":"KombatClientEngine.js"}