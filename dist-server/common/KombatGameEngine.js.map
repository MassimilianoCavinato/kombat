{"version":3,"sources":["../../src/common/KombatGameEngine.js"],"names":["KombatGameEngine","options","physicsEngine","SimplePhysicsEngine","gameEngine","collisions","autoResolve","on","moveAll","bind","e","handleCollision","Object","assign","foodRadius","headRadius","bodyRadius","eyeDist","eyeRadius","eyeAngle","spaceWidth","spaceHeight","moveDist","foodCount","eatDistance","startBodyLength","aiCount","directionStop","collideDistance","serializer","registerClass","Kombat","Bullet","Wall","Blood","x","Math","random","y","TwoVector","stepInfo","inputData","playerId","player","world","queryObject","speed","input","position","emit","direction","o1","o2","handleBulletHit","destroyObjectById","id","kombat","bullet","health","blood","clone","addObjectToWorld","timer","add","objects","removeObjectFromWorld","GameEngine"],"mappings":"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","sourcesContent":["import { GameEngine, SimplePhysicsEngine, TwoVector } from 'lance-gg';\r\nimport Kombat from './Kombat';\r\nimport Wall from './Wall';\r\nimport Bullet from './Bullet';\r\nimport Blood from './Blood';\r\n\r\nexport default class KombatGameEngine extends GameEngine {\r\n\r\n    constructor(options) {\r\n        super(options);\r\n        this.physicsEngine = new SimplePhysicsEngine({\r\n            gameEngine: this,\r\n            collisions: {\r\n                autoResolve: true,\r\n            }\r\n        });\r\n        \r\n        this.on('preStep', this.moveAll.bind(this));\r\n        this.on('postStep', (e) => {\r\n            // console.log('poststep', e);\r\n        });\r\n        this.on('collisionStart', (e) => this.handleCollision(e));\r\n           \r\n        // game variables\r\n        Object.assign(this, {\r\n            foodRadius: 0.1, \r\n            headRadius: 0.25, \r\n            bodyRadius: 0.1,\r\n            eyeDist: 0.08, \r\n            eyeRadius: 0.03, \r\n            eyeAngle: 0.5,\r\n            spaceWidth: 16, \r\n            spaceHeight: 9,\r\n            moveDist: 0.06,\r\n            foodCount: 16, \r\n            eatDistance: 0.3, \r\n            startBodyLength: 10, \r\n            aiCount: 3, \r\n            directionStop: 100,\r\n            collideDistance: 1\r\n        });\r\n    }\r\n\r\n    registerClasses(serializer) {\r\n        serializer.registerClass(Kombat);\r\n        serializer.registerClass(Bullet);\r\n        serializer.registerClass(Wall);\r\n        serializer.registerClass(Blood);\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n    }\r\n\r\n    randPos() {\r\n        let x = (Math.random() - 0.5) * this.spaceWidth;\r\n        let y = (Math.random() - 0.5) * this.spaceHeight;\r\n        return new TwoVector(x, y);\r\n    }\r\n\r\n    moveAll(stepInfo) {\r\n        return;\r\n    }\r\n\r\n    processInput(inputData, playerId) {\r\n        super.processInput(inputData, playerId);\r\n        let player = this.world.queryObject({ playerId });\r\n        let speed = 0.25;\r\n        if (player) {\r\n            if (inputData.input === 'up') {\r\n                player.position.y-=speed;\r\n            }\r\n            else if (inputData.input === 'down') {\r\n                player.position.y+=speed;\r\n            }\r\n            else if (inputData.input === 'right') {\r\n                player.position.x+=speed;\r\n            }\r\n            else if (inputData.input === 'left') {\r\n                player.position.x-=speed;\r\n            }\r\n            else if (inputData.input === 'shoot'){\r\n                this.emit('shoot', player);\r\n            }\r\n            else {\r\n                player.direction = inputData.input;\r\n            }\r\n        }\r\n    }\r\n\r\n    handleCollision(e){\r\n        if(e.o1 instanceof Kombat){\r\n            if(e.o2 instanceof Bullet){\r\n                this.handleBulletHit(e.o1, e.o2)\r\n            }\r\n        }\r\n        else if(e.o1 instanceof Bullet){\r\n            if(e.o2 instanceof Kombat){\r\n                this.handleBulletHit(e.o2, e.o1)\r\n            }\r\n            else if( e.o2 instanceof Wall){\r\n                this.destroyObjectById(e.o1.id);\r\n            }\r\n        }\r\n        else if(e.o1 instanceof Wall){\r\n            if(e.o2 instanceof Bullet){\r\n                this.destroyObjectById(e.o2.id);\r\n            }\r\n        }\r\n    }\r\n\r\n    handleBulletHit(kombat, bullet){\r\n        this.destroyObjectById(bullet.id);\r\n        kombat.health--;\r\n        let blood = new Blood(this, null, { position: kombat.position.clone() });\r\n        this.addObjectToWorld(blood);\r\n        this.timer.add(120, this.destroyObjectById, this, [blood.id]);\r\n        if(kombat.health === 0){\r\n            this.destroyObjectById(kombat.id);\r\n        }\r\n    }\r\n\r\n    destroyObjectById(id){\r\n        if (this.world.objects[id]) {\r\n            this.removeObjectFromWorld(id);\r\n        }\r\n    }\r\n}"],"file":"KombatGameEngine.js"}