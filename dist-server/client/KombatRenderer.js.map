{"version":3,"sources":["../../src/client/KombatRenderer.js"],"names":["ctx","canvas","game","C_WIDTH","C_HEIGHT","KombatRenderer","gameEngine","clientEngine","document","createElement","width","height","body","appendChild","w","h","zoom","getContext","lineWidth","offsetX","offsetY","t","dt","resetRender","playerKombat","world","queryObject","playerId","instanceType","Kombat","position","x","y","queryObjects","Blood","forEach","obj","drawBlood","forEachObject","id","drawKombat","Bullet","drawBullet","Wall","drawWall","drawUI","restore","clearRect","save","translate","scale","fillStyle","fillRect","health","max_health","beginPath","strokeStyle","rect","stroke","closePath","TwoVector","edge","Math","SQRT2","center","getCenter","radius","getCircumscribedRadiusLength","drawCircle","moveTo","lineTo","cos","direction","sin","arc","PI","fill","drawBox","splatter","sp","r","Renderer"],"mappings":"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","sourcesContent":["import { Renderer, TwoVector } from 'lance-gg';\nimport Kombat from '../common/Kombat';\nimport Bullet from '../common/Bullet';\nimport Wall from '../common/Wall';\nimport Blood from '../common/Blood';\n\nlet ctx = null;\nlet canvas = null;\nlet game = null;\nconst C_WIDTH = 800;\nconst C_HEIGHT = 600;\n\nexport default class KombatRenderer extends Renderer {\n\n    constructor(gameEngine, clientEngine) {\n        super(gameEngine, clientEngine);\n        game = gameEngine;\n        canvas = document.createElement('canvas');\n        canvas.width = C_WIDTH;\n        canvas.height = C_HEIGHT;\n        document.body.appendChild(canvas);\n        game.w = canvas.width;\n        game.h = canvas.height;\n        clientEngine.zoom = 10;\n        ctx = canvas.getContext('2d');\n        ctx.lineWidth = 2 / clientEngine.zoom;\n        this.offsetX = 0;\n        this.offsetY = 0;\n    }\n\n    draw(t, dt) {\n        super.draw(t, dt);\n        this.resetRender();\n        let playerKombat = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId,  instanceType: Kombat });\n        if(playerKombat){\n            this.offsetX = (C_WIDTH/2)/this.clientEngine.zoom - playerKombat.position.x - (playerKombat.width / 2);\n            this.offsetY = (C_HEIGHT/2)/this.clientEngine.zoom - playerKombat.position.y - (playerKombat.height / 2);\n            //draw blood stains first // layer 0\n            game.world.queryObjects({instanceType: Blood}).forEach(obj => {\n                this.drawBlood(obj);\n            });\n            game.world.forEachObject((id, obj) => {\n                if (obj instanceof Kombat) this.drawKombat(obj);\n                else if (obj instanceof Bullet) this.drawBullet(obj);\n                else if (obj instanceof Wall) this.drawWall(obj);\n            });\n            this.drawUI(playerKombat);\n        }\n        ctx.restore();\n    }\n\n    resetRender(){\n        ctx.clearRect(0, 0, game.w, game.h);\n        ctx.save();\n        ctx.translate(0, 0);\n        ctx.scale(this.clientEngine.zoom, this.clientEngine.zoom);  // Zoom in and flip y axis\n    }\n\n    drawUI(obj){\n        //Health Bar\n        ctx.fillStyle = \"red\";\n        ctx.fillRect(10/ this.clientEngine.zoom, 570/ this.clientEngine.zoom, obj.health * ( 780 / obj.max_health)/ this.clientEngine.zoom, 10/ this.clientEngine.zoom);\n        ctx.beginPath();\n        ctx.strokeStyle = \"white\";\n        ctx.rect(10/ this.clientEngine.zoom, 570/ this.clientEngine.zoom, 780 / this.clientEngine.zoom, 10/ this.clientEngine.zoom);\n        ctx.stroke();\n        ctx.closePath();\n    }\n\n    getCenter(obj){\n        return new TwoVector(\n            obj.position.x + this.offsetX + obj.width/2,\n            obj.position.y + this.offsetY + obj.height/2\n        )\n    }\n\n    getCircumscribedRadiusLength(edge){\n        return (edge * Math.SQRT2) / 2;\n    }\n\n    drawKombat(obj) {\n        ctx.fillStyle = \"transparent\";\n        ctx.strokeStyle = obj.playerId === this.gameEngine.playerId ? \"dodgerblue\" : \"crimson\";\n        let center = this.getCenter(obj);\n        let radius = this.getCircumscribedRadiusLength(obj.width);\n        this.drawCircle(center.x, center.y, radius);\n        ctx.moveTo(center.x,center.y);\n        ctx.lineTo(center.x + radius * Math.cos(obj.direction), center.y + radius * Math.sin(obj.direction));\n        ctx.stroke();\n    }\n\n    drawBullet(obj){\n        ctx.fillStyle = \"yellow\";\n        let center = this.getCenter(obj);\n        let radius = this.getCircumscribedRadiusLength(obj.width);\n        ctx.beginPath();\n        ctx.arc(center.x, center.y, radius, 0, 2*Math.PI);\n        ctx.fill();\n        ctx.closePath();\n    }\n\n    drawWall(obj){\n        ctx.strokeStyle =  \"white\";\n        let center = this.getCenter(obj);\n        this.drawBox(center.x, center.y, obj.width, obj.height);\n    }\n\n    drawBlood(obj){\n        ctx.fillStyle = 'rgba(255,0,0,.5)';\n        let center = this.getCenter(obj);\n        obj.splatter.forEach(sp => {\n            ctx.beginPath();\n            ctx.arc(center.x+sp[0], center.y+sp[1], sp[2], 0, 2*Math.PI);\n            ctx.fill();\n            ctx.closePath();\n        });\n    }\n\n    drawCircle(x, y, r, ) {\n        ctx.beginPath();\n        ctx.arc(x, y, r, 0, 2*Math.PI);\n        ctx.closePath();\n        ctx.stroke();\n    }\n\n    drawBox(x, y, w, h){\n        ctx.beginPath();\n        ctx.rect(x - (w/2), y - (h/2), w, h);\n        ctx.closePath();\n        ctx.stroke();\n    }\n}\n"],"file":"KombatRenderer.js"}