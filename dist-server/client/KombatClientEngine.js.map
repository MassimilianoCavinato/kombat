{"version":3,"sources":["../../src/client/KombatClientEngine.js"],"names":["KombatClientEngine","gameEngine","options","KombatRenderer","angle","up","down","left","mouseIsDown","controls","KeyboardControls","document","querySelector","addEventListener","window","location","reload","updateAngle","bind","e","handleMouse","preventDefault","handleKeyDown","handleKeyUp","setTimeout","instructions","getElementById","style","display","on","step","preStep","obj","playerId","type","Math","atan2","pageY","innerHeight","pageX","innerWidth","debugContainer","player","world","queryObject","innerHTML","sendInput","right","repeat","position","x","y","mouseX","mouseY","ammo_loaded","isTrusted","key","which","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\nimport KombatRenderer from '../client/KombatRenderer';\n\nexport default class KombatClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n\n        super(gameEngine, options, KombatRenderer);\n\n        this.angle = 0;\n        this.up = false;\n        this.down = false;\n        this.left = false;\n        this.down = false;\n        this.mouseIsDown = false;\n\n        this.controls = new KeyboardControls(this);\n        \n        // restart game\n        document.querySelector('#try-again').addEventListener('click', () => {\n            window.location.reload();\n        });\n        // show try-again button\n\n        document.addEventListener('mouseenter', this.updateAngle.bind(this), false);\n        document.addEventListener('mousemove', this.updateAngle.bind(this), false);\n        document.addEventListener('mousedown', (e) => this.handleMouse(e) );\n        document.addEventListener('mouseup', (e) => this.handleMouse(e));\n        document.addEventListener('contextmenu', (e) => e.preventDefault());\n        document.addEventListener('keydown', (e) => this.handleKeyDown(e));\n        document.addEventListener('keyup', (e) => this.handleKeyUp(e));\n\n        setTimeout( () => {\n            let instructions = document.getElementById('kombat-instructions');\n            instructions.style.display = 'none';\n        }, 3000);\n        this.gameEngine.on('client__preStep', (step) => this.preStep(step));\n        this.gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId && obj.type === \"Kombat\") {\n                document.querySelector('#try-again').style.display = \"block\";\n            }\n        });\n    }\n\n    updateAngle(e) {\n        e.preventDefault();\n        this.angle = Math.atan2(e.pageY - window.innerHeight/2, e.pageX - window.innerWidth/2);\n    }\n    \n    preStep() {\n        let debugContainer = document.getElementById('debug');\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n        if(player === null){\n            debugContainer.innerHTML = ``;\n        }\n        else{\n            this.sendInput('step', { \n                up: this.up,\n                left: this.left,\n                down: this.down,\n                right: this.right,\n                angle: this.angle\n            });\n\n            if(this.mouseIsDown === true){\n                this.sendInput(\"shoot\", { repeat: true });\n            }\n\n            debugContainer.innerHTML = `\n            PlayerPos:\n            <br/> \n            X: ${player.position.x}\n            <br/> \n            Y: ${player.position.y}\n            <br/>\n            ----------------------------\n            <br/>\n            MousePos: \n            <br/> \n            X: ${this.mouseX}\n            <br/> \n            Y: ${this.mouseY}\n            <br/> \n            ----------------------------\n            <br/>\n            Angle: ${this.angle}\n            <br/>\n            ----------------------------\n            <br/>\n            Is shooting: ${this.mouseIsDown ? \"true\" : \"false\"}\n            <br/>\n            ----------------------------\n            <br/>\n            Ammo: ${player.ammo_loaded}\n            <br/>\n            ----------------------------\n            <br/>\n            Is reloading: ${player.ammo_loaded === 0 ? \"true\" : \"false\"}\n            <br/>\n            ----------------------------\n        `\n        }\n    }\n\n    handleKeyDown(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = true;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = true;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = true;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = true;\n            }\n        }\n    }\n\n    handleKeyUp(e){\n        if(e.isTrusted === true){\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\n                this.up = false;\n            }\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\n                this.left = false;\n            }\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\n                this.down = false;\n            }\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\n                this.right = false;\n            }\n        }\n    }\n\n    handleMouse(e){\n        e.preventDefault();\n        if(e.isTrusted === true){\n            if(e.which === 1){\n                this.mouseIsDown = e.type === \"mousedown\";\n            }\n            else if(e.which === 3){\n                if(e.type === 'mousedown'){\n                    this.sendInput('throw_power', { repeat: false });\n                }\n                if(e.type === 'mouseup'){\n                    this.sendInput('granade', { repeat: false });\n                }\n            }\n        }\n    }\n\n}\n"],"file":"KombatClientEngine.js"}