{"version":3,"sources":["../../src/common/KombatGameEngine.js"],"names":["KombatGameEngine","options","physicsEngine","SimplePhysicsEngine","gameEngine","collisions","autoResolve","on","stepInfo","preStep","postStep","e","handleCollision","serializer","registerClass","Kombat","Bullet","Granade","Wall","Blood","Explosion2","DeadZone","Heal2","x","Math","random","spaceWidth","y","spaceHeight","TwoVector","inputData","playerId","player","world","queryObject","step","input","timer_shot","emit","granade_loaded","throwing_granade","throw_power","ammo_loaded","ammo_capacity","speed","right","left","up","down","velocity","move_angle","atan2","cos","sin","direction","angle","name","o1","o2","destroyObjectById","id","checkBouce","checkBounce","objects","removeObjectFromWorld","a","b","collision_side","position","width","abs","prevVelocity","kombats","queryObjects","instanceType","forEach","kombat","deadZone","radius","GameEngine"],"mappings":"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","sourcesContent":["import { GameEngine, SimplePhysicsEngine, TwoVector } from 'lance-gg';\nimport Kombat from './Kombat';\nimport Wall from './Wall';\nimport Bullet from './Bullet';\nimport Granade from './Granade';\nimport Blood from './Blood';\nimport Explosion2 from './Explosion2';\nimport DeadZone from './DeadZone';\nimport Heal2 from './Heal2';\n\nexport default class KombatGameEngine extends GameEngine {\n\n    constructor(options) {\n        super(options);\n        this.physicsEngine = new SimplePhysicsEngine({\n            gameEngine: this,\n            collisions: {\n                autoResolve: true,\n            }\n        });\n        this.on('preStep', (stepInfo) => this.preStep(stepInfo));\n        this.on('postStep', (stepInfo) => this.postStep(stepInfo));\n        this.on('collisionStart', (e) => this.handleCollision(e));\n\n        // game variables\n        // Object.assign(this, {\n        //     foodRadius: 0.1, \n        //     headRadius: 0.25, \n        //     bodyRadius: 0.1,\n        //     eyeDist: 0.08, \n        //     eyeRadius: 0.03, \n        //     eyeAngle: 0.5,\n        //     spaceWidth: 16, \n        //     spaceHeight: 9,\n        //     moveDist: 0.06,\n        //     foodCount: 16, \n        //     eatDistance: 0.3, \n        //     startBodyLength: 10, \n        //     aiCount: 3, \n        //     directionStop: 100,\n        //     collideDistance: 1\n        // });\n    }\n\n    registerClasses(serializer) {\n        serializer.registerClass(Kombat);\n        serializer.registerClass(Bullet);\n        serializer.registerClass(Granade);\n        serializer.registerClass(Wall);\n        serializer.registerClass(Blood);\n        serializer.registerClass(Explosion2);\n        serializer.registerClass(DeadZone);\n        serializer.registerClass(Heal2);\n    }\n\n    start() {\n        super.start();\n    }\n\n    randPos() {\n        let x = (Math.random() - 0.5) * this.spaceWidth;\n        let y = (Math.random() - 0.5) * this.spaceHeight;\n        return new TwoVector(x, y);\n    }\n\n    processInput(inputData, playerId) {\n        super.processInput(inputData, playerId);\n        let player = this.world.queryObject({ playerId });\n        \n        if (player) {\n            let step = inputData.step;\n            if (inputData.input === 'shoot'){\n                if(step  >= player.timer_shot + 10){\n                    player.timer_shot = step;\n                    this.emit('shoot', player);\n                }\n            }\n            else if (inputData.input === 'throw_power'){\n                if(player.granade_loaded > 0){\n                    player.throwing_granade = 1;\n                    player.throw_power = .03;\n                }\n            }\n            else if (inputData.input === 'granade'){\n                player.throwing_granade = 0;\n                this.emit('granade', player);\n            }\n            else if (inputData.input === \"reload\"){\n                if(player.ammo_loaded < player.ammo_capacity && player.ammo_loaded >= 0){\n                    player.ammo_loaded = 0;\n                    this.emit('shoot', player);\n                }\n            }\n            else if (inputData.input === \"pickup\"){\n                this.emit('pickup', player);\n            }\n            else if(inputData.input === 'step') {\n\n                let speed;\n                let x = 0;\n                let y = 0;\n\n                if( player.throwing_granade === 1 ){\n                    speed = 0.16;\n                }\n                else if( step  <= player.timer_shot + 15 ){\n                    speed = 0.21;\n                }\n                else{\n                    speed = 0.24;\n                }\n\n                if(inputData.options.right){\n                    x++;\n                }\n                if(inputData.options.left){\n                    x--;\n                }\n                if(inputData.options.up){\n                    y--;\n                }\n                if(inputData.options.down){\n                    y++;\n                }\n                if(x == 0 && y === 0){\n                    player.velocity.x = 0;\n                    player.velocity.y = 0;\n                }\n                else{\n                    let move_angle = Math.atan2(y, x);\n                    player.velocity.x = speed * Math.cos(move_angle);\n                    player.velocity.y = speed * Math.sin(move_angle);\n                }\n                \n                player.direction =  inputData.options.angle;\n            }\n        }\n        else{\n            if (inputData.input === 'play'){\n                this.emit('play', { playerId: inputData.options.playerId, name: inputData.options.name });\n            }\n        }\n    }\n\n    handleCollision(e){\n        if(e.o1 instanceof Kombat){\n            if(e.o2 instanceof Bullet){\n                this.emit('bullethit', e.o1);\n                this.destroyObjectById(e.o2.id);\n            }\n            else if(e.o2 instanceof Granade){\n                this.checkBouce(e.o2, e.o1);\n            }\n        }\n        else if(e.o1 instanceof Bullet){\n            this.destroyObjectById(e.o1.id);\n            if(e.o2 instanceof Kombat){\n                this.emit('bullethit', e.o2);\n            }\n        }\n        else if(e.o1 instanceof Wall){\n            if(e.o2 instanceof Bullet){\n                this.destroyObjectById(e.o2.id);\n            }\n            else if(e.o2 instanceof Granade){\n                this.checkBounce(e.o2, e.o1);\n            }\n        }\n        else if(e.o1 instanceof Granade){\n            if(e.o2 instanceof Wall){\n                this.checkBounce(e.o1, e.o2);\n            }\n            else if(e.o2 instanceof Kombat){\n                this.checkBounce(e.o1, e.o2);\n            }\n        }\n    }\n\n    destroyObjectById(id){\n        if (this.world.objects[id]) {\n            this.removeObjectFromWorld(id);\n        }   \n    }\n\n\n    checkBounce(a,b){\n\n        let collision_side;\n    \n        if(a.position.x + a.width <= b.position.x ){ \n            //hitting from left;\n            a.velocity.x = -Math.abs(a.prevVelocity.x);\n    \n        }\n        else if(a.position.x >= b.position.x + b.width){\n            //hitting from right\n            a.velocity.x = Math.abs(a.prevVelocity.x);\n\n        }\n        else if(a.position.y < b.position.y){\n            //hitting from top\n            a.velocity.y = -Math.abs(a.prevVelocity.y);\n\n        }\n        else if(a.position.y > b.position.y){\n            //hitting from bottom\n            a.velocity.y = Math.abs(a.prevVelocity.y);\n        }\n    }\n\n    preStep(stepInfo){\n        let kombats = this.world.queryObjects({ instanceType : Kombat });\n        kombats.forEach(kombat => {\n            if(kombat.throw_power > 0){\n                kombat.throw_power += .015\n                if(kombat.throw_power  > 1){\n                    kombat.throw_power = 1;\n                }\n            }\n        });\n    }\n\n    postStep(stepInfo){\n        let deadZone = this.world.queryObject({ instanceType : DeadZone });\n        if(deadZone){\n            deadZone.radius -= .03;\n\n        }\n\n    }\n}"],"file":"KombatGameEngine.js"}