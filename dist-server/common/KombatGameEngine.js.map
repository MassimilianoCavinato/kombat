{"version":3,"sources":["../../src/common/KombatGameEngine.js"],"names":["KombatGameEngine","options","physicsEngine","SimplePhysicsEngine","gameEngine","collisions","autoResolve","on","stepInfo","preStep","postStep","e","handleCollision","serializer","registerClass","Kombat","Bullet","Granade","Wall","Blood","Explosion2","DeadZone","x","Math","random","spaceWidth","y","spaceHeight","TwoVector","inputData","playerId","player","world","queryObject","step","input","timer_shot","emit","granade_loaded","throwing_granade","throw_power","speed","right","left","up","down","velocity","move_angle","atan2","cos","sin","direction","angle","o1","o2","handleBulletHit","destroyObjectById","id","kombat","bullet","health","blood","position","clone","addObjectToWorld","timer","add","objects","removeObjectFromWorld","kombats","queryObjects","instanceType","forEach","GameEngine"],"mappings":"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","sourcesContent":["import { GameEngine, SimplePhysicsEngine, TwoVector } from 'lance-gg';\r\nimport Kombat from './Kombat';\r\nimport Wall from './Wall';\r\nimport Bullet from './Bullet';\r\nimport Granade from './Granade';\r\nimport Blood from './Blood';\r\nimport Explosion2 from './Explosion2';\r\nimport DeadZone from './DeadZone';\r\n\r\nexport default class KombatGameEngine extends GameEngine {\r\n\r\n    constructor(options) {\r\n        super(options);\r\n        this.physicsEngine = new SimplePhysicsEngine({\r\n            gameEngine: this,\r\n            collisions: {\r\n                autoResolve: true,\r\n            }\r\n        });\r\n        this.on('preStep', (stepInfo) => this.preStep(stepInfo));\r\n        this.on('postStep', (stepInfo) => this.postStep(stepInfo));\r\n        this.on('collisionStart', (e) => this.handleCollision(e));\r\n\r\n        // game variables\r\n        // Object.assign(this, {\r\n        //     foodRadius: 0.1, \r\n        //     headRadius: 0.25, \r\n        //     bodyRadius: 0.1,\r\n        //     eyeDist: 0.08, \r\n        //     eyeRadius: 0.03, \r\n        //     eyeAngle: 0.5,\r\n        //     spaceWidth: 16, \r\n        //     spaceHeight: 9,\r\n        //     moveDist: 0.06,\r\n        //     foodCount: 16, \r\n        //     eatDistance: 0.3, \r\n        //     startBodyLength: 10, \r\n        //     aiCount: 3, \r\n        //     directionStop: 100,\r\n        //     collideDistance: 1\r\n        // });\r\n    }\r\n\r\n    registerClasses(serializer) {\r\n        serializer.registerClass(Kombat);\r\n        serializer.registerClass(Bullet);\r\n        serializer.registerClass(Granade);\r\n        serializer.registerClass(Wall);\r\n        serializer.registerClass(Blood);\r\n        serializer.registerClass(Explosion2);\r\n        serializer.registerClass(DeadZone);\r\n    }\r\n\r\n    start() {\r\n        super.start();\r\n    }\r\n\r\n    randPos() {\r\n        let x = (Math.random() - 0.5) * this.spaceWidth;\r\n        let y = (Math.random() - 0.5) * this.spaceHeight;\r\n        return new TwoVector(x, y);\r\n    }\r\n\r\n    processInput(inputData, playerId) {\r\n        super.processInput(inputData, playerId);\r\n        let player = this.world.queryObject({ playerId });\r\n        \r\n        if (player) {\r\n            let step = inputData.step;\r\n            if (inputData.input === 'shoot'){\r\n                if(step  >= player.timer_shot + 15){\r\n                    player.timer_shot = step;\r\n                    this.emit('shoot', player);\r\n                }\r\n            }\r\n            else if (inputData.input === 'throw_power'){\r\n                if(player.granade_loaded > 0){\r\n                    player.throwing_granade = 1;\r\n                    player.throw_power = .03;\r\n                }\r\n            }\r\n            else if (inputData.input === 'granade'){\r\n                player.throwing_granade = 0;\r\n                this.emit('granade', player);\r\n            }\r\n            else if(inputData.input === 'step') {\r\n\r\n                let speed;\r\n                let x = 0;\r\n                let y = 0;\r\n\r\n                if( player.throwing_granade === 1 ){\r\n                    speed = 0.16;\r\n                }\r\n                else if( step  <= player.timer_shot + 15 ){\r\n                    speed = 0.21;\r\n                }\r\n                else{\r\n                    speed = 0.24;\r\n                }\r\n\r\n                if(inputData.options.right){\r\n                    x++;\r\n                }\r\n                if(inputData.options.left){\r\n                    x--;\r\n                }\r\n                if(inputData.options.up){\r\n                    y--;\r\n                }\r\n                if(inputData.options.down){\r\n                    y++;\r\n                }\r\n                if(x == 0 && y === 0){\r\n                    player.velocity.x = 0;\r\n                    player.velocity.y = 0;\r\n                }\r\n                else{\r\n                    let move_angle = Math.atan2(y, x);\r\n                    player.velocity.x = speed * Math.cos(move_angle);\r\n                    player.velocity.y = speed * Math.sin(move_angle);\r\n                }\r\n                \r\n                player.direction =  inputData.options.angle;\r\n            }\r\n        }\r\n    }\r\n\r\n    handleCollision(e){\r\n        if(e.o1 instanceof Kombat){\r\n            if(e.o2 instanceof Bullet){\r\n                this.handleBulletHit(e.o1, e.o2)\r\n            }\r\n        }\r\n        else if(e.o1 instanceof Bullet){\r\n            if(e.o2 instanceof Kombat){\r\n                this.handleBulletHit(e.o2, e.o1)\r\n            }\r\n            else if( e.o2 instanceof Wall){\r\n                this.destroyObjectById(e.o1.id);\r\n            }\r\n        }\r\n        else if(e.o1 instanceof Wall){\r\n            if(e.o2 instanceof Bullet){\r\n                this.destroyObjectById(e.o2.id);\r\n            }\r\n        }\r\n    }\r\n\r\n    handleBulletHit(kombat, bullet){\r\n        this.destroyObjectById(bullet.id);\r\n        kombat.health--;\r\n        let blood = new Blood(this, null, { position: kombat.position.clone() });\r\n        this.addObjectToWorld(blood);\r\n        this.timer.add(600, this.destroyObjectById, this, [blood.id]);\r\n        if(kombat.health <= 0){\r\n            this.destroyObjectById(kombat.id);\r\n        }\r\n    }\r\n\r\n    destroyObjectById(id){\r\n        if (this.world.objects[id]) {\r\n            this.removeObjectFromWorld(id);\r\n        }   \r\n    }\r\n\r\n    preStep(stepInfo){\r\n        let kombats = this.world.queryObjects({ instanceType : Kombat });\r\n        kombats.forEach(kombat => {\r\n            if(kombat.throw_power > 0){\r\n                kombat.throw_power += .015\r\n                if(kombat.throw_power  > 1){\r\n                    kombat.throw_power = 1;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    postStep(stepInfo){\r\n        \r\n    }\r\n}"],"file":"KombatGameEngine.js"}