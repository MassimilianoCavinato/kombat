{"version":3,"sources":["../../src/client/KombatClientEngine.js"],"names":["KombatClientEngine","gameEngine","options","KombatRenderer","angle","up","down","left","mouseIsDown","controls","KeyboardControls","document","querySelector","addEventListener","window","location","reload","updateAngle","bind","e","handleMouse","preventDefault","handleKeyDown","handleKeyUp","on","step","preStep","obj","playerId","type","style","display","Math","atan2","pageY","innerHeight","pageX","innerWidth","debugContainer","getElementById","player","world","queryObject","innerHTML","sendInput","right","repeat","position","x","y","mouseX","mouseY","ammo_loaded","isTrusted","key","which","ClientEngine"],"mappings":"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","sourcesContent":["import { ClientEngine, KeyboardControls } from 'lance-gg';\r\nimport KombatRenderer from '../client/KombatRenderer';\r\n\r\nexport default class KombatClientEngine extends ClientEngine {\r\n\r\n    constructor(gameEngine, options) {\r\n\r\n        super(gameEngine, options, KombatRenderer);\r\n\r\n        this.angle = 0;\r\n        this.up = false;\r\n        this.down = false;\r\n        this.left = false;\r\n        this.down = false;\r\n        this.mouseIsDown = false;\r\n\r\n        this.controls = new KeyboardControls(this);\r\n        \r\n        // restart game\r\n        document.querySelector('#try-again').addEventListener('click', () => {\r\n            window.location.reload();\r\n        });\r\n        // show try-again button\r\n\r\n        document.addEventListener('mouseenter', this.updateAngle.bind(this), false);\r\n        document.addEventListener('mousemove', this.updateAngle.bind(this), false);\r\n        document.addEventListener('mousedown', (e) => this.handleMouse(e) );\r\n        document.addEventListener('mouseup', (e) => this.handleMouse(e));\r\n        document.addEventListener('contextmenu', (e) => e.preventDefault());\r\n        document.addEventListener('keydown', (e) => this.handleKeyDown(e));\r\n        document.addEventListener('keyup', (e) => this.handleKeyUp(e));\r\n\r\n        this.gameEngine.on('client__preStep', (step) => this.preStep(step));\r\n        this.gameEngine.on('objectDestroyed', (obj) => {\r\n            if (obj.playerId === gameEngine.playerId && obj.type === \"Kombat\") {\r\n                document.querySelector('#try-again').style.display = \"block\";\r\n            }\r\n        });\r\n    }\r\n\r\n    updateAngle(e) {\r\n        e.preventDefault();\r\n        this.angle = Math.atan2(e.pageY - window.innerHeight/2, e.pageX - window.innerWidth/2);\r\n    }\r\n    \r\n    preStep() {\r\n        let debugContainer = document.getElementById('debug');\r\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\r\n        if(player === null){\r\n            debugContainer.innerHTML = ``;\r\n        }\r\n        else{\r\n            this.sendInput('step', { \r\n                up: this.up,\r\n                left: this.left,\r\n                down: this.down,\r\n                right: this.right,\r\n                angle: this.angle\r\n            });\r\n\r\n            if(this.mouseIsDown === true){\r\n                this.sendInput(\"shoot\", { repeat: true });\r\n            }\r\n\r\n            debugContainer.innerHTML = `\r\n            PlayerPos:\r\n            <br/> \r\n            X: ${player.position.x}\r\n            <br/> \r\n            Y: ${player.position.y}\r\n            <br/>\r\n            ----------------------------\r\n            <br/>\r\n            MousePos: \r\n            <br/> \r\n            X: ${this.mouseX}\r\n            <br/> \r\n            Y: ${this.mouseY}\r\n            <br/> \r\n            ----------------------------\r\n            <br/>\r\n            Angle: ${this.angle}\r\n            <br/>\r\n            ----------------------------\r\n            <br/>\r\n            Is shooting: ${this.mouseIsDown ? \"true\" : \"false\"}\r\n            <br/>\r\n            ----------------------------\r\n            <br/>\r\n            Ammo: ${player.ammo_loaded}\r\n            <br/>\r\n            ----------------------------\r\n            <br/>\r\n            Is reloading: ${player.ammo_loaded === 0 ? \"true\" : \"false\"}\r\n            <br/>\r\n            ----------------------------\r\n        `\r\n        }\r\n    }\r\n\r\n    handleKeyDown(e){\r\n        if(e.isTrusted === true){\r\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\r\n                this.up = true;\r\n            }\r\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\r\n                this.left = true;\r\n            }\r\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\r\n                this.down = true;\r\n            }\r\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\r\n                this.right = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    handleKeyUp(e){\r\n        if(e.isTrusted === true){\r\n            if(e.key === \"w\" || e.key === \"ArrowUp\"){\r\n                this.up = false;\r\n            }\r\n            else if(e.key === \"a\" || e.key === \"ArrowLeft\"){\r\n                this.left = false;\r\n            }\r\n            else if(e.key === \"s\" || e.key === \"ArrowDown\"){\r\n                this.down = false;\r\n            }\r\n            else if(e.key === \"d\" || e.key === \"ArrowRight\"){\r\n                this.right = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    handleMouse(e){\r\n        e.preventDefault();\r\n        if(e.isTrusted === true){\r\n            if(e.which === 1){\r\n                this.mouseIsDown = e.type === \"mousedown\";\r\n            }\r\n            else if(e.which === 3){\r\n                if(e.type === 'mousedown'){\r\n                    this.sendInput('throw_power', { repeat: false });\r\n                }\r\n                if(e.type === 'mouseup'){\r\n                    this.sendInput('granade', { repeat: false });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n"],"file":"KombatClientEngine.js"}