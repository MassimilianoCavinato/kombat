{"version":3,"sources":["../../src/server/KombatServerEngine.js"],"names":["KombatServerEngine","io","gameEngine","inputOptions","on","shoot","bind","walls","forEach","w","wall","Wall","position","TwoVector","addObjectToWorld","socket","kombat","Kombat","playerId","max_health","health","last_shot","socketId","world","queryObject","instanceType","removeObjectFromWorld","id","speed","liveTimer","bullet","Bullet","direction","ownerId","x","width","y","height","velocity","Math","cos","sin","timer","add","destroyObjectById","objects","ServerEngine"],"mappings":"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","sourcesContent":["import { ServerEngine, TwoVector } from 'lance-gg';\nimport Kombat from '../common/Kombat';\nimport Bullet from '../common/Bullet';\nimport Wall from '../common/Wall';\n\nexport default class KombatServerEngine extends ServerEngine {\n\n    constructor(io, gameEngine, inputOptions) {\n        super(io, gameEngine, inputOptions);\n        this.gameEngine.on('shoot', this.shoot.bind(this));\n    }\n\n    start() {\n        super.start();\n        let walls = [\n            [0,0],\n            [2, 19],\n            [12,4],\n            [3,9],\n            [16, 16],\n            [22, 13],\n            [8,26],\n        ];\n\n        walls.forEach(w => {\n            let wall = new Wall(this.gameEngine, null, { position: new TwoVector(w[0], w[1]) });\n            this.gameEngine.addObjectToWorld(wall);\n        });\n    }\n\n    onPlayerConnected(socket) {\n        super.onPlayerConnected(socket);\n        let kombat = new Kombat(this.gameEngine, null, { position: new TwoVector(10, 10) });\n        kombat.playerId = socket.playerId;\n        kombat.max_health = 10;\n        kombat.health = 10;\n        kombat.last_shot = 0;\n        this.gameEngine.addObjectToWorld(kombat);\n    }\n\n    onPlayerDisconnected(socketId, playerId) {\n        super.onPlayerDisconnected(socketId, playerId);\n        let kombat = this.gameEngine.world.queryObject({ playerId: playerId,  instanceType: Kombat });\n        if (kombat) this.gameEngine.removeObjectFromWorld(kombat.id);\n    }\n\n    shoot(kombat) {\n        let speed = 0.7;\n        let liveTimer = 70; //gameloops\n        let bullet = new Bullet(this.gameEngine, null, { \n            direction: kombat.direction,\n            playerId: kombat.playerId,\n            ownerId: kombat.id,\n            position: new TwoVector(\n                kombat.position.x + (kombat.width / 4),\n                kombat.position.y + (kombat.height / 4)\n            ),\n            velocity: new TwoVector(\n                Math.cos(kombat.direction) * speed ,\n                Math.sin(kombat.direction) * speed\n            )\n        });\n\n        this.gameEngine.addObjectToWorld(bullet);\n        this.gameEngine.timer.add(liveTimer, this.destroyObjectById, this, [bullet.id]);\n    }\n\n    destroyObjectById(id) {\n        if (this.gameEngine.world.objects[id]) {\n            this.gameEngine.removeObjectFromWorld(id);\n        }\n    }\n\n}\n"],"file":"KombatServerEngine.js"}