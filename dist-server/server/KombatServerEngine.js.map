{"version":3,"sources":["../../src/server/KombatServerEngine.js"],"names":["RANDOM_SPAWNS","TwoVector","KombatServerEngine","io","gameEngine","inputOptions","on","shoot","bind","granade","pickup","stepInfo","postStep","deadzoneTimer","add_Map","map","add_DeadZone","w","h","Math","floor","random","forEach","wall","Wall","position","x","y","width","height","addObjectToWorld","deadZone","DeadZone","get_randomVectorInBound","radius","heal","Heal2","socket","kombat","Kombat","playerId","name","max_health","health","ammo_capacity","ammo_loaded","granade_capacity","granade_loaded","throw_power","throwing_granade","timer_shot","timer_deadzone","_shoot_side","socketId","world","queryObject","instanceType","removeObjectFromWorld","id","speed","kombatPos","clone","kombatDir","direction","add","shoot_side","cos","sin","liveTimer","bullet","Bullet","ownerId","velocity","timer","destroyObjectById","reloadAmmo","Granade","explode","heals","queryObjects","i","length","d","sqrt","pow","objects","kombatId","granadeId","explosion","Explosion2","kombats","k","blood","Blood","step","damage","distance","ServerEngine"],"mappings":"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","sourcesContent":["import { ServerEngine, TwoVector } from 'lance-gg';\nimport Kombat from '../common/Kombat';\nimport Bullet from '../common/Bullet';\nimport Granade from '../common/Granade';\nimport Wall from '../common/Wall';\nimport Explosion2 from '../common/Explosion2';\nimport Blood from '../common/Blood';\nimport DeadZone from '../common/DeadZone';\nimport Heal2 from '../common/Heal2';\nimport { map } from './map1';\n\nconst RANDOM_SPAWNS = [\n    new TwoVector(10, 10),\n    new TwoVector(40, 10),\n    new TwoVector(10, 40),\n    new TwoVector(40, 40)\n];\n\nexport default class KombatServerEngine extends ServerEngine {\n\n    constructor(io, gameEngine, inputOptions) {\n        super(io, gameEngine, inputOptions);\n        this.gameEngine.on('shoot', this.shoot.bind(this));\n        this.gameEngine.on('granade', this.granade.bind(this));\n        this.gameEngine.on('pickup', this.pickup.bind(this));\n        this.gameEngine.on('postStep', (stepInfo) => this.postStep(stepInfo));\n        this.deadzoneTimer = 0;\n    }\n\n    start() {\n        super.start();\n        this.add_Map(map);\n        this.add_DeadZone();\n    }\n\n    get_randomVectorInBound(w, h){\n        return new TwoVector(\n            Math.floor(Math.random() * w - 16) + 8 , \n            Math.floor(Math.random() * h - 16) + 8 \n        )\n    }\n\n    add_Map(map){\n        map.forEach(w => {\n            let wall = new Wall(this.gameEngine, null, { \n                position: new TwoVector(w.x, w.y), \n                width: w.width,\n                height: w.height,\n            });\n\n            this.gameEngine.addObjectToWorld(wall);\n        });\n    }\n\n    add_DeadZone(){\n        let deadZone = new DeadZone(this.gameEngine, null, { position: this.get_randomVectorInBound(100, 100)});\n        deadZone.radius = 150;\n        this.gameEngine.addObjectToWorld(deadZone);\n\n        //add heal\n        let heal = new Heal2(this.gameEngine, null, { position: this.get_randomVectorInBound(100, 100)});\n        this.gameEngine.addObjectToWorld(heal);\n    }\n\n    onPlayerConnected(socket) {\n        super.onPlayerConnected(socket);\n\n        let kombat = new Kombat(this.gameEngine, null, { position: this.get_randomVectorInBound(100, 100)});\n\n        kombat.playerId = socket.playerId;\n        kombat.name = 'Kombat '+socket.playerId;\n        kombat.max_health = 100;\n        kombat.health = 100;\n        kombat.ammo_capacity = 64;\n        kombat.ammo_loaded =  64;\n        kombat.granade_capacity = 48;\n        kombat.granade_loaded =  48;\n        kombat.throw_power = 0;\n        kombat.throwing_granade = false;\n        kombat.timer_shot = 0;\n        kombat.timer_deadzone = 0;\n        kombat._shoot_side = 'l';\n        this.gameEngine.addObjectToWorld(kombat);\n    }\n\n    onPlayerDisconnected(socketId, playerId) {\n        super.onPlayerDisconnected(socketId, playerId);\n        let kombat = this.gameEngine.world.queryObject({ playerId: playerId,  instanceType: Kombat });\n        if (kombat) this.gameEngine.removeObjectFromWorld(kombat.id);\n    }\n\n    shoot(kombat) {\n        if(kombat.ammo_loaded > 0){\n            kombat.ammo_loaded--;\n            let speed = 0.5;\n            let kombatPos = kombat.position.clone();\n            let kombatDir = kombat.direction;\n\n            kombatPos.add(new TwoVector(.5, .5));\n            let position;\n          \n            if(kombat.shoot_side === 'l'){\n                position = new TwoVector(\n                    kombatPos.x + 1 * Math.cos(kombatDir-1.5),\n                    kombatPos.y + 1 * Math.sin(kombatDir-1.5)\n                )\n                kombat.shoot_side = \"r\";\n            }\n            else{\n                position = new TwoVector(\n                    kombatPos.x  + 1 *  Math.cos(kombatDir+1.5),\n                    kombatPos.y  + 1 *  Math.sin(kombatDir+1.5)\n                )\n                kombat.shoot_side = \"l\";\n            }\n          \n            let liveTimer = 100; //gameloops\n            let bullet = new Bullet(this.gameEngine, null, { \n                direction: kombatDir,\n                playerId: kombat.playerId,\n                ownerId: kombat.id,\n                position: position,\n                velocity: new TwoVector(\n                    Math.cos(kombatDir) * speed ,\n                    Math.sin(kombatDir) * speed\n                )\n            });\n            this.gameEngine.addObjectToWorld(bullet);\n            this.gameEngine.timer.add(liveTimer, this.destroyObjectById, this, [bullet.id]);\n        }\n        else if(kombat.ammo_loaded === 0 ){\n            kombat.ammo_loaded--;\n            this.gameEngine.timer.add(240, this.reloadAmmo, this, [kombat.id]);\n        }\n    }\n\n    granade(kombat) {\n        if(kombat.granade_loaded > 0){\n            kombat.granade_loaded--;\n            let speed = .4 * kombat.throw_power;\n            let granade = new Granade(this.gameEngine, null, { \n                direction: kombat.direction,\n                position: new TwoVector(\n                    kombat.position.x + (kombat.width / 4),\n                    kombat.position.y + (kombat.height / 4)\n                ),\n                velocity: new TwoVector(\n                    Math.cos(kombat.direction) * speed ,\n                    Math.sin(kombat.direction) * speed\n                )\n            });\n            kombat.throw_power = 0;\n        \n            granade.playerId = kombat.playerId;\n            this.gameEngine.addObjectToWorld(granade);\n            this.gameEngine.timer.add(100, this.explode, this, [granade.id]);\n        }\n    }\n\n    pickup(kombat){\n     \n        let heals = this.gameEngine.world.queryObjects({instanceType: Heal2 });\n        for(let i=0; i<heals.length; i++){\n            let h = heals[i];\n             let d = Math.sqrt(\n                Math.pow( kombat.position.x+kombat.width/2 - h.position.x , 2) +  \n                Math.pow( kombat.position.y+kombat.height/2 - h.position.y,2)\n            );\n           \n            if(d < 1.5){\n                kombat.health += 30;\n                if(kombat.health > kombat.max_health){\n                    kombat.health = kombat.max_health;\n                }\n                this.gameEngine.removeObjectFromWorld(h.id);\n                return false;\n            }\n        }\n    }\n\n    destroyObjectById(id) {\n        if (this.gameEngine.world.objects[id]) {\n            this.gameEngine.removeObjectFromWorld(id);\n        }\n    }\n\n    reloadAmmo(kombatId){\n        let kombat = this.gameEngine.world.queryObject({ id: kombatId, instanceType: Kombat });\n        if(kombat){\n            kombat.ammo_loaded = kombat.ammo_capacity;\n        }\n    }\n\n    explode(granadeId) {\n        let granade = this.gameEngine.world.queryObject({ id: granadeId, instanceType: Granade });\n        if(granade){\n            let position = granade.position.clone();\n            let explosion = new Explosion2(this.gameEngine, null, { \n                position: position\n            });\n            this.destroyObjectById(granadeId);\n            explosion.radius = 10;\n            this.gameEngine.addObjectToWorld(explosion);\n            this.gameEngine.timer.add(150, this.destroyObjectById, this, [explosion.id]);\n            \n            let kombats = this.gameEngine.world.queryObjects({ instanceType: Kombat });\n            kombats.forEach(k=> {\n                let d = Math.sqrt(\n                    Math.pow( k.position.x+k.width/2 - position.x , 2) +  Math.pow( k.position.y+k.height/2 - position.y,2)\n                );\n                if(d <= explosion.radius){\n                    k.health -= 3;\n                    if(d <= explosion.radius/2){\n                       k.health -= 3; \n                    }\n                    if(d <= explosion.radius/4){\n                        k.health -= 3; \n                    }\n                    let blood = new Blood(this.gameEngine, null, { position: k.position.clone() });\n                    if(k.health <= 0){\n                        this.destroyObjectById(k.id);\n                    }\n                    this.gameEngine.addObjectToWorld(blood);\n                    this.gameEngine.timer.add(600, this.destroyObjectById, this, [blood.id]);\n                }\n            });\n        }\n    }\n\n    postStep(stepInfo){\n\n        let deadZone = this.gameEngine.world.queryObject({ instanceType : DeadZone });\n        if(deadZone){\n\n            if(deadZone.radius < -10){\n\n                deadZone.position.x = Math.floor(Math.random() * 90) + 10\n                deadZone.position.y = Math.floor(Math.random() * 90) + 10 \n                deadZone.radius = 150;\n                let heal = new Heal2(this.gameEngine, null, { position: deadZone.position.clone()})\n                this.gameEngine.addObjectToWorld(heal);\n            }\n            else{\n\n                if(stepInfo.step - this.deadzoneTimer > 60 ){\n                    this.deadzoneTimer = stepInfo.step;\n                    let kombats = this.gameEngine.world.queryObjects({ instanceType : Kombat });\n                    let damage = 2;\n                    if(deadZone.radius < 50){\n                        damage += 2;\n                    }\n                    else if(deadZone.radius < 30){\n                        damage += 4;\n                    }\n                    else if(deadZone.radius < 10){\n                        damage += 6;\n                    }\n                    kombats.forEach(k => {\n                        let distance = Math.sqrt(\n                            Math.pow( k.position.x + k.width/2 - deadZone.x , 2) +  Math.pow( k.position.y + k.height/2 - deadZone.position.y,2)\n                        );\n                        if(distance >= deadZone.radius){\n                            k.health -= damage;\n                            let blood = new Blood(this.gameEngine, null, { position: k.position.clone() });\n                            if(k.health <= 0){\n                                this.destroyObjectById(k.id);\n                            }\n                            this.gameEngine.addObjectToWorld(blood);\n                            this.gameEngine.timer.add(600, this.destroyObjectById, this, [blood.id]);\n                        }\n                    })\n                }\n                deadZone.radius -= .04;\n            }\n        }\n    }\n}\n"],"file":"KombatServerEngine.js"}